# TIL(Today I Learned)

___

> Mar/10th/2022_Multi campus_유선종 Day58

## 합성곱 신경망(CNN)
CNN은 이미지 인식과 음성 인식 등 다양한 곳에서 사용되는데, 특히 이미지 인식 분야에서는 CNN을 기초로 한다.

### 1. CNN 계층
CNN은 특징을 추출하여 정제하는 feature Extractor 계층과 기존의 딥러닝을 사용하는 Classifier 계층이 존재한다. Classifier 계층은 우리가 이미 구현한 딥러닝과 동일한 구조이므로 CNN에서 추가로 생성된 feature Extractor 계층에 대해서 알아보자.

### 2. feature Extractor
feature Extractor는 합성곱 계층(convolution)과 풀링(pooling)계층으로 나눌 수 있다. 합성공 계층 사이에 보통 relu 활성화 함수가 들어가고 relu를 빠져나온 신호는 그대로 사용되거나 pooling 계층을 거치며, 이러한 과정을 여러번 거친 후에 최종 출력 결과를 Classifier에 넘겨준다.

#### 1. feature Extractor를 사용하는 이유
1. 우리가 기존에 사용하는 딥러닝 신경망은 이미지에 적합하지 않다. 왜냐하면 이미지는 가로 x 세로 x 색상으로 구성된 3차원 데이터인데, 딥러닝에서는 1차원으로 변환해줘야 한다.
2. 합성곱 계층은 이러한 3차원의 형상을 유지한 상태로 계산을 해준다. 여기서 합성곱의 연산을 필터 연산(filter)라고 부른다.
3. 연산은 입력과 필터에서 대응하는 원소끼리 곱한 후, 그 총합을 구하여 행렬로 출력한다. 이를 단일 곱셈-누산(FMA)이라 한다.

<img src="https://user-images.githubusercontent.com/97590480/157688052-0c4ab8d5-75d3-4499-9cd4-0c48ab5e0f1e.png">

> 위의 이미지를 보면 (4,4) 행렬 중에서 왼쪽 위 (3,3) 원소들과 필터를 곱하여 하나의 스칼라 값을 출력층 (1,1)에 넣는다. 나머지도 이러한 방식으로 출력값을 계산한다.

4. 합성곱 계층에도 편향값이 존재할 수 있다. 각 원소마다 편향값을 더해주기만 하면 된다.

#### 2. 패딩
합성곱 연산을 수행하기 전에 데이터 주변을 0의 값으로 채우는 것을 패딩(padding)이라 한다.
1. 패딩은 출력 크기를 조절할 목적으로 사용한다. 예를 들어, (4,4) 입력층에 (3,3) 필터를 적용하면 출력층은 (2,2)이다. 그런데 패딩을 적용하면 (6,6)으로 출력층은 (4,4)이다. 즉, 원래의 입력층과 출력층을 동일한 크기로 설정하기 위해 사용하낟.
2. 패딩을 적용하면 일반적으로 성능이 올라가는 것이 알려져 있다.

<img src="https://user-images.githubusercontent.com/97590480/157689093-50576a00-203c-4cf0-987d-a8f30ab29300.png">

#### 3. 스트라이드
필터를 적용하는 위치의 간격을 스트라이드(stride)라고 한다. 위의 합성곱 계산에서는 스트라이드가 1인 상황이였다. 스트라이드가 2인 상황이라면 밑의 이미지와 같다.

<img src="https://user-images.githubusercontent.com/97590480/157690251-dbd736c4-a281-4d0a-9211-85593ef17c0e.png">

그런데 스트라이드를 2로 설정하면 출력층은 (3,3)로 크기가 작아진다. 이처럼 출력층에 영향을 미치는 요소를 공식으로 표현하면 다음과 같다.

```
입력 크기 (H,W), 필터 크기 (FH, FW), 패딩을 P, 스트라이드를 S라 하면 출력 크기(OH, OW)를 구하는 공식은 다음과 같다.
OH = [(H + 2P - FH) / S] + 1
OW = [(W + 2P - FW) / S] + 1
```
#### 4. 블록으로 생각하기
<img src="https://user-images.githubusercontent.com/97590480/157692231-8c3e6b48-315b-4105-a2ed-97ae2a7bd1c5.png">

- 위의 이미지를 보면 입력 데이터가 (C, H, W), 필터가 (C, FH, FW) 일 경우, 출력층은 (1, OH, OW)가 나온다.
- 즉, C개의 입력층과 필터가 계산 과정에서 하나로 합쳐져서 출력층에서 출력되는 것을 볼 수 있다.
- 만약 출력층에 여러개의 층을 쌓고 싶다면 필터를 여러 개로 설정하면 된다.

<img src="https://user-images.githubusercontent.com/97590480/157692281-9dc70e60-f61b-41b8-8dbf-b597c95a4b88.png">

- 위의 이미지를 보면 출력 데이터가 필터의 갯수인 FN개 만큼 출력층이 형성되어 출력되는 것을 확인할 수 있다.

#### 5. 풀링 계층
풀링 계층에서는 세로와 가로 방향의 공간을 줄이는 연산이다. 예를 들어, 2x2 영역을 1x1으로 축소시켜주는 연산을 담당한다.

<img src="https://user-images.githubusercontent.com/97590480/157693244-66e532ec-c969-4c09-af09-f64889afb343.png">

1. 풀링에서는 최대 풀링(max pooling)과 평균 풀링(average pooling)이 있다. 최대 풀링은 2x2영역에서 최댓값을 출력층으로 전달하는 방법이고, 평균 풀링은 2x2 영역의 평균값을 전달하는 방법이다.
2. 보통 최대 풀링의 성능이 더 좋은 것으로 알려져 있다. 특히, 이미지가 정형화되어 있지 않고 난잡할 때 더욱 성능이 발휘된다.
3. 풀링은 채널마다 독립적으로 계산하기 때문에 필터와는 다르게 채널 수가 변하지 않는다.